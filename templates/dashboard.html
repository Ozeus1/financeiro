{% extends "base.html" %}

{% block title %}Dashboard - Sistema Financeiro{% endblock %}

{% block content %}
<div class="row mt-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h2><i class="bi bi-speedometer2"></i> Dashboard - {{ mes_atual }}/{{ ano_atual }}</h2>
        <button class="btn btn-outline-secondary" id="toggleValores" title="Mostrar/Ocultar Valores">
            <i class="bi bi-eye-slash" id="iconToggle"></i>
            <span id="textToggle">Ocultar Valores</span>
        </button>
    </div>
    <div class="col-12">
        <hr>
    </div>
</div>

<!-- Cards Resumo (Competência) -->
<div class="row mt-3">
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-cash-coin"></i> Receitas do Mês</h5>
                <h3 class="valor-monetario">R$ {{ total_receitas|moeda }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card text-white bg-danger mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-wallet2"></i> Despesas do Mês</h5>
                <h3 class="valor-monetario">R$ {{ total_despesas|moeda }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card text-white {% if saldo >= 0 %}bg-primary{% else %}bg-warning{% endif %} mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-piggy-bank"></i> Saldo do Mês</h5>
                <h3 class="valor-monetario">R$ {{ saldo|moeda }}</h3>
            </div>
        </div>
    </div>
</div>

<!-- Resumo do Fluxo de Caixa (Realizado) -->
<div class="row mt-3">
    <div class="col-12">
        <h5 class="text-muted"><i class="bi bi-cash-stack"></i> Fluxo de Caixa (Realizado)</h5>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title">Entradas (Caixa)</h5>
                <h3 class="valor-monetario">R$ {{ fluxo_entradas|moeda }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-secondary mb-3">
            <div class="card-body">
                <h5 class="card-title">Saídas (Caixa)</h5>
                <h3 class="valor-monetario">R$ {{ fluxo_saidas|moeda }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white {% if fluxo_saldo >= 0 %}bg-primary{% else %}bg-warning{% endif %} mb-3">
            <div class="card-body">
                <h5 class="card-title">Saldo (Caixa)</h5>
                <h3 class="valor-monetario">R$ {{ fluxo_saldo|moeda }}</h3>
            </div>
        </div>
    </div>
</div>

<!-- Últimas Despesas e Receitas -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Últimas Despesas</h5>
            </div>
            <div class="card-body">
                {% if ultimas_despesas %}
                <div class="list-group">
                    {% for despesa in ultimas_despesas %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ despesa.descricao }}</h6>
                            <small>{{ despesa.data_pagamento.strftime('%d/%m/%Y') }}</small>
                        </div>
                        <p class="mb-1">
                            <span class="badge bg-secondary">{{ despesa.categoria.nome }}</span>
                            <span class="badge bg-info">{{ despesa.meio_pagamento.nome }}</span>
                        </p>
                        <strong class="text-danger valor-monetario">R$ {{ despesa.valor|moeda }}</strong>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">Nenhuma despesa registrada este mês.</p>
                {% endif %}
                <div class="mt-3">
                    <a href="{{ url_for('despesas.lista') }}" class="btn btn-sm btn-outline-primary">Ver todas</a>
                    <a href="{{ url_for('despesas.criar') }}" class="btn btn-sm btn-primary">Nova despesa</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Últimas Receitas</h5>
            </div>
            <div class="card-body">
                {% if ultimas_receitas %}
                <div class="list-group">
                    {% for receita in ultimas_receitas %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ receita.descricao }}</h6>
                            <small>{{ receita.data_recebimento.strftime('%d/%m/%Y') }}</small>
                        </div>
                        <p class="mb-1">
                            <span class="badge bg-secondary">{{ receita.categoria.nome }}</span>
                            <span class="badge bg-info">{{ receita.meio_recebimento.nome }}</span>
                        </p>
                        <strong class="text-success valor-monetario">R$ {{ receita.valor|moeda }}</strong>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">Nenhuma receita registrada este mês.</p>
                {% endif %}
                <div class="mt-3">
                    <a href="{{ url_for('receitas.lista') }}" class="btn btn-sm btn-outline-success">Ver todas</a>
                    <a href="{{ url_for('receitas.criar') }}" class="btn btn-sm btn-success">Nova receita</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Links Rápidos -->
<div class="row mt-4 mb-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-speedometer"></i> Acesso Rápido</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('relatorios.balanco') }}" class="btn btn-outline-primary btn-lg d-block">
                            <i class="bi bi-bar-chart fs-1"></i><br>
                            Balanço Mensal
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('relatorios.top_contas') }}" class="btn btn-outline-warning btn-lg d-block">
                            <i class="bi bi-star fs-1"></i><br>
                            Top 10 Contas
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('despesas.exportar') }}" class="btn btn-outline-success btn-lg d-block">
                            <i class="bi bi-file-earmark-excel fs-1"></i><br>
                            Exportar Despesas
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('receitas.exportar') }}" class="btn btn-outline-info btn-lg d-block">
                            <i class="bi bi-file-earmark-excel fs-1"></i><br>
                            Exportar Receitas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('toggleValores').addEventListener('click', function() {
        const valores = document.querySelectorAll('.valor-monetario');
        const icon = document.getElementById('iconToggle');
        const text = document.getElementById('textToggle');

        // Verifica o estado atual (se está oculto ou não)
        const isHidden = valores[0].style.filter === 'blur(8px)';

        valores.forEach(valor => {
            if (isHidden) {
                // Mostrar valores
                valor.style.filter = 'none';
                icon.className = 'bi bi-eye-slash';
                text.textContent = 'Ocultar Valores';
            } else {
                // Ocultar valores
                valor.style.filter = 'blur(8px)';
                icon.className = 'bi bi-eye';
                text.textContent = 'Mostrar Valores';
            }
        });
    });
});
</script>
{% endblock %}